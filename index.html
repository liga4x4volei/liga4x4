<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>üèê Liga 4x4 ‚Äì Classifica√ß√£o e Jogos</title>

<style>
body{font-family:Arial;background:linear-gradient(90deg,#004aad,#8ba9d1);margin:0;padding:10px}
h1,h2{color:#fff;text-align:center}
table{width:100%;border-collapse:collapse;background:#fff;margin-bottom:20px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#111;color:#fff}
.classificado{background:#c40000;color:#fff;font-weight:bold}

.nome-time{width:100%;font-weight:bold;text-align:center}

.jogos{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
@media(max-width:800px){.jogos{grid-template-columns:1fr}}

.jogo{background:#fff;border-radius:10px;padding:12px}
.times{display:flex;justify-content:space-between;align-items:center;font-weight:bold}
.time{display:flex;align-items:center;gap:6px}

.time img{width:28px;height:28px;object-fit:contain}

.set{margin-top:6px;text-align:center}
.placar{display:flex;gap:6px;justify-content:center}
input{width:45px;text-align:center}

.admin{position:fixed;bottom:15px;right:15px;padding:12px;background:#111;color:#fff;border:none;border-radius:20px}
</style>
</head>

<body>

<h1>üèê Liga 4x4</h1>

<h2>üèÜ Classifica√ß√£o</h2>
<table>
<thead>
<tr><th>Pos</th><th>Time</th><th>J</th><th>Sets+</th><th>Saldo</th><th>Vit</th></tr>
</thead>
<tbody id="classificacao"></tbody>
</table>

<h2>üìã Jogos</h2>
<div class="jogos" id="jogos"></div>

<button class="admin" onclick="toggleAdmin()">ADMIN</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCovHcUFKP9dtwRxfnajhvGUgluCFp0HVQ",
  authDomain: "liga4x4volei-71358.firebaseapp.com",
  projectId: "liga4x4volei-71358"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const REF = db.collection("liga4x4").doc("dados");

const SENHA="liga4x4";
let admin=false;

const IDS=[...Array(12)].map((_,i)=>"t"+(i+1));

let times={}, jogos=[];

function gerarBase(){
  IDS.forEach(id=>times[id]={nome:"Time "+id.substring(1),logo:""});
  for(let i=0;i<IDS.length;i++)
    for(let j=i+1;j<IDS.length;j++)
      jogos.push({a:IDS[i],b:IDS[j],sets:[[null,null],[null,null],[null,null]]});
}

function toggleAdmin(){
  if(prompt("Senha:")==SENHA){admin=!admin;render();}
}

function render(){
  renderClassificacao();
  renderJogos();
}

function renderClassificacao(){
  const s=calc();
  const tb=document.getElementById("classificacao");
  tb.innerHTML="";
  Object.entries(s).sort(([,a],[,b])=>b.sets-a.sets||b.saldo-a.saldo||b.vit-a.vit)
  .forEach(([id,v],i)=>{
    tb.innerHTML+=`
    <tr class="${i<4?'classificado':''}">
      <td>${i+1}</td>
      <td>
        ${admin?`
          <input class="nome-time" value="${times[id].nome}"
          oninput="times['${id}'].nome=this.value;save();renderJogos()">`
        :`
          <div class="time">
            ${times[id].logo?`<img src="${times[id].logo}">`:''}
            ${times[id].nome}
          </div>`}
      </td>
      <td>${v.j}</td><td>${v.sets}</td><td>${v.saldo}</td><td>${v.vit}</td>
    </tr>`;
  });
}

function renderJogos(){
  const d=document.getElementById("jogos"); d.innerHTML="";
  jogos.forEach((j,i)=>{
    d.innerHTML+=`
    <div class="jogo">
      <b>Jogo ${i+1}</b>
      <div class="times">
        <div class="time">${times[j.a].logo?`<img src="${times[j.a].logo}">`:''}${times[j.a].nome}</div>
        <div class="time">${times[j.b].logo?`<img src="${times[j.b].logo}">`:''}${times[j.b].nome}</div>
      </div>
      ${j.sets.map((s,k)=>`
        <div class="set">SET ${k+1}
          <div class="placar">
            <input ${admin?'':'disabled'} value="${s[0]??''}" onchange="upd(${i},${k},0,this.value)">
            x
            <input ${admin?'':'disabled'} value="${s[1]??''}" onchange="upd(${i},${k},1,this.value)">
          </div>
        </div>`).join("")}
    </div>`;
  });
}

function upd(i,s,t,v){
  jogos[i].sets[s][t]=v===''?null:+v;
  save(); renderClassificacao();
}

function calc(){
  const r={}; IDS.forEach(id=>r[id]={j:0,sets:0,saldo:0,vit:0});
  jogos.forEach(j=>{
    let sa=0,sb=0,ok=false;
    j.sets.forEach(s=>{
      if(s[0]!=null&&s[1]!=null){
        ok=true;
        if(s[0]>s[1]){sa++;r[j.a].sets++;r[j.a].saldo++;r[j.b].saldo--;}
        else{sb++;r[j.b].sets++;r[j.b].saldo++;r[j.a].saldo--;}
      }
    });
    if(ok){r[j.a].j++;r[j.b].j++;}
    if(sa>=2)r[j.a].vit++;
    if(sb>=2)r[j.b].vit++;
  });
  return r;
}

async function save(){
  await REF.set({times,jogos},{merge:true});
}

async function start(){
  const s=await REF.get();
  if(s.exists){({times,jogos}=s.data());}
  else{gerarBase(); save();}
  render();
}
start();
</script>
</body>
</html>
