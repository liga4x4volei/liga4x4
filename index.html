<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèê Liga 4x4 ‚Äì Classifica√ß√£o e Jogos</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:linear-gradient(90deg,#004aad,#8ba9d1);
  margin:0;
  padding:10px;
}
h1,h2{color:#fff;text-align:center}
table{
  width:100%;
  background:#fff;
  border-collapse:collapse;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}
th{background:#111;color:#fff}
.classificado{background:#c40000;color:#fff;font-weight:bold}

.jogos{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  margin-top:15px;
}
.jogo{
  background:#fff;
  padding:12px;
  border-radius:10px;
}
.times{
  display:flex;
  justify-content:space-between;
  font-weight:bold;
  margin-bottom:8px;
}
.set{
  text-align:center;
}
.placar{
  display:flex;
  gap:5px;
  justify-content:center;
}
input{
  width:45px;
  text-align:center;
}
button{
  position:fixed;
  bottom:15px;
  right:15px;
  padding:12px 18px;
}
</style>
</head>

<body>

<h1>üèê Liga 4x4</h1>

<h2>üèÜ Classifica√ß√£o</h2>
<table>
<thead>
<tr>
<th>Pos</th><th>Time</th><th>J</th><th>Sets+</th><th>Saldo</th><th>Vit</th>
</tr>
</thead>
<tbody id="classificacao"></tbody>
</table>

<h2>üìã Jogos</h2>
<div class="jogos" id="jogos"></div>

<button onclick="toggleAdmin()">ADMIN</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCovHcUFKP9dtwRxfnajhvGUgluCFp0HVQ",
  authDomain: "liga4x4volei-71358.firebaseapp.com",
  projectId: "liga4x4volei-71358"
});

const db = firebase.firestore();
const REF = db.collection("liga4x4").doc("dados");

const TIMES = Array.from({length:12},(_,i)=>`t${i+1}`);
let nomesTimes = {};
TIMES.forEach((id,i)=>nomesTimes[id]=`Time ${i+1}`);

let jogos = [];
let isAdmin = false;

function criarJogos(){
  jogos=[];
  for(let i=0;i<TIMES.length;i++){
    for(let j=i+1;j<TIMES.length;j++){
      jogos.push({
        a:TIMES[i],
        b:TIMES[j],
        sets:{
          s1:{a:null,b:null},
          s2:{a:null,b:null},
          s3:{a:null,b:null}
        }
      });
    }
  }
}

function toggleAdmin(){
  if(prompt("Senha:")==="liga4x4"){
    isAdmin=!isAdmin;
    render();
  }
}

async function salvar(){
  await REF.set({nomesTimes,jogos},{merge:true});
}

function atualizar(j,s,t,v){
  jogos[j].sets[s][t]=v===""?null:+v;
  salvar();
  renderClassificacao();
}

function calcular(){
  const stats={};
  TIMES.forEach(t=>stats[t]={j:0,sets:0,saldo:0,vit:0});

  jogos.forEach(j=>{
    let sa=0,sb=0,real=false;
    Object.values(j.sets).forEach(s=>{
      if(s.a!=null && s.b!=null){
        real=true;
        if(s.a>s.b){sa++;stats[j.a].sets++;stats[j.a].saldo++;stats[j.b].saldo--;}
        else{sb++;stats[j.b].sets++;stats[j.b].saldo++;stats[j.a].saldo--;}
      }
    });
    if(real){stats[j.a].j++;stats[j.b].j++;}
    if(sa>=2)stats[j.a].vit++;
    if(sb>=2)stats[j.b].vit++;
  });
  return stats;
}

function renderClassificacao(){
  const stats=calcular();
  const tb=document.getElementById("classificacao");
  tb.innerHTML="";
  Object.entries(stats)
    .sort(([,a],[,b])=>b.sets-a.sets||b.saldo-a.saldo)
    .forEach(([id,s],i)=>{
      tb.innerHTML+=`
      <tr class="${i<4?'classificado':''}">
        <td>${i+1}</td>
        <td>${isAdmin?`<input value="${nomesTimes[id]}" oninput="nomesTimes['${id}']=this.value;salvar();renderJogos()">`:nomesTimes[id]}</td>
        <td>${s.j}</td><td>${s.sets}</td><td>${s.saldo}</td><td>${s.vit}</td>
      </tr>`;
    });
}

function renderJogos(){
  const div=document.getElementById("jogos");
  div.innerHTML="";
  jogos.forEach((j,i)=>{
    div.innerHTML+=`
    <div class="jogo">
      <div class="times"><span>${nomesTimes[j.a]}</span><span>${nomesTimes[j.b]}</span></div>
      ${Object.entries(j.sets).map(([k,s])=>`
        <div class="set">
          ${k.toUpperCase()}
          <div class="placar">
            <input ${!isAdmin?"disabled":""} value="${s.a??""}" onchange="atualizar(${i},'${k}','a',this.value)">
            x
            <input ${!isAdmin?"disabled":""} value="${s.b??""}" onchange="atualizar(${i},'${k}','b',this.value)">
          </div>
        </div>`).join("")}
    </div>`;
  });
}

function render(){
  renderClassificacao();
  renderJogos();
}

async function iniciar(){
  const snap=await REF.get();
  if(snap.exists){
    const d=snap.data();
    nomesTimes=d.nomesTimes||nomesTimes;
    jogos=Array.isArray(d.jogos)?d.jogos:[];
  }
  if(jogos.length===0){criarJogos();salvar();}
  render();
}

iniciar();
</script>

</body>
</html>
