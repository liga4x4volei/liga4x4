<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>üèê Liga 4x4</title>

<style>
body{
  font-family:Arial;
  background:linear-gradient(90deg,#004aad,#8ba9d1);
  margin:0;padding:10px
}
h1,h2{color:#fff;text-align:center}

table{width:100%;background:#fff;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:6px;text-align:center}
th{background:#111;color:#fff}
.classificado{background:#c40000;color:#fff;font-weight:bold}

.jogos{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
@media(max-width:800px){.jogos{grid-template-columns:1fr}}

.jogo{background:#fff;padding:10px;border-radius:10px}
.times{display:flex;justify-content:space-between;font-weight:bold}

.time{
  display:flex;
  align-items:center;
  gap:6px;
}
.time img{
  width:24px;
  height:24px;
  object-fit:contain;
}

.sets{display:flex;justify-content:space-around}
.placar{display:flex;align-items:center;gap:4px}
input{width:40px;text-align:center}

.admin-btn{
  position:fixed;bottom:15px;right:15px;
  padding:10px;border:none;border-radius:20px
}
</style>
</head>

<body>

<h1>üèê Liga 4x4</h1>

<h2>Classifica√ß√£o</h2>
<table>
<thead>
<tr><th>#</th><th>Time</th><th>J</th><th>Sets+</th><th>Saldo</th><th>Vit</th></tr>
</thead>
<tbody id="classificacao"></tbody>
</table>

<h2>Jogos</h2>
<div class="jogos" id="jogos"></div>

<button class="admin-btn" onclick="admin()">ADMIN</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCovHcUFKP9dtwRxfnajhvGUgluCFp0HVQ",
  authDomain: "liga4x4volei-71358.firebaseapp.com",
  projectId: "liga4x4volei-71358",
  storageBucket: "liga4x4volei-71358.appspot.com"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();
const REF = db.collection("liga4x4").doc("dados");

const SENHA="liga4x4";
let isAdmin=false;

const TIMES=[...Array(12)].map((_,i)=>"t"+(i+1));

let times={};
TIMES.forEach(id=>{
  times[id]={nome:"Time "+id.substring(1),logo:""}
});

let jogos=[];
for(let i=0;i<TIMES.length;i++){
  for(let j=i+1;j<TIMES.length;j++){
    jogos.push({
      a:TIMES[i],
      b:TIMES[j],
      sets:{
        s1:{a:null,b:null},
        s2:{a:null,b:null},
        tb:{a:null,b:null}
      }
    });
  }
}

function admin(){
  if(prompt("Senha")==SENHA){isAdmin=!isAdmin;render();}
}

async function uploadLogo(e,id){
  const file=e.target.files[0];
  if(!file)return;
  const ref=storage.ref(`logos/${id}.png`);
  await ref.put(file);
  times[id].logo=await ref.getDownloadURL();
  save();
  render();
}

async function save(){
  await REF.set({times,jogos});
}

function calc(){
  const s={};
  TIMES.forEach(id=>s[id]={j:0,sets:0,saldo:0,vit:0});

  jogos.forEach(j=>{
    let a=0,b=0,real=false;
    Object.values(j.sets).forEach(set=>{
      if(set.a!=null&&set.b!=null){
        real=true;
        if(set.a>set.b){a++;s[j.a].sets++;s[j.a].saldo++;s[j.b].saldo--}
        else{b++;s[j.b].sets++;s[j.b].saldo++;s[j.a].saldo--}
      }
    });
    if(real){s[j.a].j++;s[j.b].j++}
    if(a>=2)s[j.a].vit++;
    if(b>=2)s[j.b].vit++;
  });
  return s;
}

function render(){
  const stats=calc();
  const rank=Object.entries(stats)
    .sort(([,a],[,b])=>b.sets-a.sets||b.saldo-a.saldo);

  const tb=document.getElementById("classificacao");
  tb.innerHTML="";
  rank.forEach(([id,s],i)=>{
    tb.innerHTML+=`
    <tr class="${i<4?"classificado":""}">
      <td>${i+1}</td>
      <td class="time">
        ${times[id].logo?`<img src="${times[id].logo}">`:""}
        ${isAdmin?`
          <input value="${times[id].nome}" oninput="times['${id}'].nome=this.value;save();render()">
          <input type="file" onchange="uploadLogo(event,'${id}')">
        `:times[id].nome}
      </td>
      <td>${s.j}</td><td>${s.sets}</td><td>${s.saldo}</td><td>${s.vit}</td>
    </tr>`;
  });

  const div=document.getElementById("jogos");
  div.innerHTML="";
  jogos.forEach((j,i)=>{
    div.innerHTML+=`
    <div class="jogo">
      <div class="times">
        <div class="time">${times[j.a].logo?`<img src="${times[j.a].logo}">`:""}${times[j.a].nome}</div>
        <div class="time">${times[j.b].logo?`<img src="${times[j.b].logo}">`:""}${times[j.b].nome}</div>
      </div>
      <div class="sets">
        ${Object.entries(j.sets).map(([k,v])=>`
          <div>
            ${k.toUpperCase()}
            <div class="placar">
              <input ${!isAdmin?"disabled":""} value="${v.a??""}"
                onchange="jogos[${i}].sets.${k}.a=+this.value;save();render()">
              x
              <input ${!isAdmin?"disabled":""} value="${v.b??""}"
                onchange="jogos[${i}].sets.${k}.b=+this.value;save();render()">
            </div>
          </div>
        `).join("")}
      </div>
    </div>`;
  });
}

async function start(){
  const s=await REF.get();
  if(s.exists){({times,jogos}=s.data())}
  else save();
  render();
}
start();
</script>

</body>
</html>
