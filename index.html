<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>üèê Liga 4x4</title>

<style>
body{font-family:Arial;background:#004aad;color:#fff;margin:0;padding:10px}
h1,h2{text-align:center}

table{width:100%;background:#fff;color:#000;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#111;color:#fff}
.classificado{background:#c40000;color:#fff}

.time-cell{
  display:flex;
  align-items:center;
  gap:6px;
}
.time-cell img{
  width:28px;
  height:28px;
  object-fit:contain;
}

.jogos{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:20px}
@media(max-width:900px){.jogos{grid-template-columns:1fr}}

.jogo{background:#fff;color:#000;padding:10px;border-radius:8px}
.times{display:flex;justify-content:space-between;font-weight:bold}

.sets{display:flex;justify-content:space-around;margin-top:8px}
.placar{display:flex;align-items:center;gap:4px}

input{width:40px;text-align:center}

.admin-btn{
 position:fixed;bottom:15px;right:15px;
 background:#111;color:#fff;border:none;
 padding:10px 16px;border-radius:20px
}
</style>
</head>

<body>

<h1>üèê Liga 4x4</h1>

<h2>üèÜ Classifica√ß√£o</h2>
<table>
<thead>
<tr><th>Pos</th><th>Time</th><th>J</th><th>Sets+</th><th>Saldo</th><th>Vit</th></tr>
</thead>
<tbody id="classificacao"></tbody>
</table>

<h2>üìã Jogos</h2>
<div class="jogos" id="jogos"></div>

<button class="admin-btn" onclick="toggleAdmin()">ADMIN</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* FIREBASE */
firebase.initializeApp({
 apiKey: "AIzaSyCovHcUFKP9dtwRxfnajhvGUgluCFp0HVQ",
 authDomain: "liga4x4volei-71358.firebaseapp.com",
 projectId: "liga4x4volei-71358"
});
const db = firebase.firestore();
const REF = db.collection("liga4x4").doc("dados");

/* CONFIG */
const TIMES=[...Array(12)].map((_,i)=>"t"+(i+1));
let nomesTimes={}, jogos=[], isAdmin=false;

/* DEFAULT */
TIMES.forEach(id=>{
  nomesTimes[id]={
    nome:"Time "+id.substring(1),
    logo:`https://raw.githubusercontent.com/SEUUSUARIO/liga4x4/main/logos/${id}.png`
  }
});

/* JOGOS */
for(let i=0;i<TIMES.length;i++){
 for(let j=i+1;j<TIMES.length;j++){
  jogos.push({a:TIMES[i],b:TIMES[j],sets:[[null,null],[null,null],[null,null]]});
 }
}

/* ADMIN */
function toggleAdmin(){
 if(prompt("Senha:")==="liga4x4"){isAdmin=!isAdmin;render();}
}

/* RENDER */
function render(){
 renderClassificacao();
 renderJogos();
}

function renderClassificacao(){
 const stats=calc();
 const tb=document.getElementById("classificacao");
 tb.innerHTML="";
 Object.entries(stats).sort((a,b)=>b[1].sets-a[1].sets).forEach(([id,s],i)=>{
  const t=nomesTimes[id]||{nome:id,logo:""};
  tb.innerHTML+=`
   <tr class="${i<4?"classificado":""}">
    <td>${i+1}</td>
    <td class="time-cell">
      <img src="${t.logo}">
      ${isAdmin?`<input value="${t.nome}" oninput="editNome('${id}',this.value)">`:t.nome}
    </td>
    <td>${s.j}</td><td>${s.sets}</td><td>${s.saldo}</td><td>${s.vit}</td>
   </tr>`;
 });
}

function renderJogos(){
 const div=document.getElementById("jogos");
 div.innerHTML="";
 jogos.forEach((j,i)=>{
  div.innerHTML+=`
  <div class="jogo">
   <div class="times">
    <span>${nomesTimes[j.a]?.nome}</span>
    <span>${nomesTimes[j.b]?.nome}</span>
   </div>
   <div class="sets">
    ${[0,1,2].map(s=>`
     <div>
      <small>${s==2?"TIE":"SET "+(s+1)}</small>
      <div class="placar">
       <input ${!isAdmin?"disabled":""} onchange="setPlacar(${i},${s},0,this.value)">
       x
       <input ${!isAdmin?"disabled":""} onchange="setPlacar(${i},${s},1,this.value)">
      </div>
     </div>`).join("")}
   </div>
  </div>`;
 });
}

/* L√ìGICA */
function editNome(id,v){
 nomesTimes[id].nome=v;
 REF.set({nomesTimes,jogos},{merge:true});
 render();
}

function setPlacar(i,s,t,v){
 jogos[i].sets[s][t]=v===""?null:+v;
 REF.set({nomesTimes,jogos},{merge:true});
 render();
}

function calc(){
 const st={}; TIMES.forEach(id=>st[id]={j:0,sets:0,saldo:0,vit:0});
 jogos.forEach(j=>{
  let sa=0,sb=0,ok=false;
  j.sets.forEach(s=>{
   if(s[0]!=null&&s[1]!=null){
    ok=true;
    if(s[0]>s[1]){sa++;st[j.a].sets++;st[j.a].saldo++;st[j.b].saldo--;}
    else{sb++;st[j.b].sets++;st[j.b].saldo++;st[j.a].saldo--;}
   }
  });
  if(ok){st[j.a].j++;st[j.b].j++;}
  if(sa>=2)st[j.a].vit++;
  if(sb>=2)st[j.b].vit++;
 });
 return st;
}

/* START */
REF.get().then(s=>{
 if(s.exists){
  nomesTimes=s.data().nomesTimes||nomesTimes;
  jogos=s.data().jogos||jogos;
 }
 render();
});
</script>

</body>
</html>
