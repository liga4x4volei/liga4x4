<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèê Liga 4x4 ‚Äì Classifica√ß√£o e Jogos</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:linear-gradient(90deg,#004aad,#8ba9d1);
  margin:0;
  padding:10px;
}
h1,h2{color:#fff;text-align:center}

table{
  width:100%;
  background:#fff;
  border-collapse:collapse;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}
th{background:#111;color:#fff}
.classificado{background:#c40000;color:#fff;font-weight:bold}

.time-cell{
  display:flex;
  align-items:center;
  gap:6px;
  justify-content:center;
}
.time-cell img{
  width:42px;
  height:42px;
  object-fit:contain;
}

.jogos{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  margin-top:15px;
}
.jogo{
  background:#fff;
  padding:12px;
  border-radius:10px;
}
.jogo h3{
  margin:0 0 6px 0;
  text-align:center;
}
.times{
  display:flex;
  justify-content:space-between;
  font-weight:bold;
  margin-bottom:8px;
}
.time{
  display:flex;
  align-items:center;
  gap:6px;
}
.time img{
  width:36px;
  height:36px;
}

.set{text-align:center}
.placar{
  display:flex;
  gap:5px;
  justify-content:center;
}
input{
  width:45px;
  text-align:center;
}
input.logo{
  width:100%;
}

button{
  position:fixed;
  bottom:15px;
  right:15px;
  padding:12px 18px;
}

.proximos-jogos{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
  margin:15px 0 25px;
}

.proximo-card{
  background:#fff;
  border-left:6px solid #c40000;
  padding:12px 15px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.2);
}

.proximo-card h3{
  margin:0 0 8px;
  color:#111;
  font-size:16px;
}

.proximo-card p{
  margin:4px 0;
  font-size:14px;
}

.proximo-card .confronto{
  margin-top:8px;
  font-size:18px;
  font-weight:bold;
  text-align:center;
}

.proximo-card .confronto span{
  margin:0 6px;
  color:#c40000;
}

/* MOBILE */
@media(max-width:700px){
  .proximos-jogos{
    grid-template-columns:1fr;
  }
}

</style>
</head>

<body>

<h1>üèê Liga 4x4</h1>

<div class="proximos-jogos">

  <div class="proximo-card">
    <h3>üîú Pr√≥ximo Jogo</h3>
    <p><strong>üìÖ Data:</strong> 07 de janeiro ‚Äì 20h</p>
    <p><strong>üìç Local:</strong> Arena Bel√©m</p>
    <p class="confronto">Watchatchara <span>x</span> RGS</p>
  </div>

  <div class="proximo-card">
    <h3>‚è≠Ô∏è Jogo Seguinte</h3>
    <p><strong>üìÖ Data:</strong> 07 de janeiro ‚Äì 19h</p>
    <p><strong>üìç Local:</strong> Arena Bel√©m</p>
    <p class="confronto">Time 3 <span>x</span> Time 4</p>
  </div>

</div>


<h2>üèÜ Classifica√ß√£o</h2>
<table>
<thead>
<tr>
<th>Pos</th><th>Time</th><th>J</th><th>Sets+</th><th>Saldo</th><th>Vit</th>
</tr>
</thead>
<tbody id="classificacao"></tbody>
</table>

<h2>üìã Jogos</h2>
<div class="jogos" id="jogos"></div>

<button onclick="toggleAdmin()">ADMIN</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCovHcUFKP9dtwRxfnajhvGUgluCFp0HVQ",
  authDomain: "liga4x4volei-71358.firebaseapp.com",
  projectId: "liga4x4volei-71358"
});

const db = firebase.firestore();
const REF = db.collection("liga4x4").doc("dados");

/* ================= TIMES ================= */
const TIMES = Array.from({length:12},(_,i)=>`t${i+1}`);
let nomesTimes = {};
let logosTimes = {};

TIMES.forEach((id,i)=>{
  nomesTimes[id]=`Time ${i+1}`;
  logosTimes[id]="";
});

/* ================= JOGOS ================= */
let jogos = [];
let isAdmin = false;

function criarJogos(){
  jogos=[];
  for(let i=0;i<TIMES.length;i++){
    for(let j=i+1;j<TIMES.length;j++){
      jogos.push({
        a:TIMES[i],
        b:TIMES[j],
        sets:{
          s1:{a:null,b:null},
          s2:{a:null,b:null},
          s3:{a:null,b:null}
        }
      });
    }
  }
}

/* ================= ADMIN ================= */
function toggleAdmin(){
  if(prompt("Senha:")==="liga4x4"){
    isAdmin=!isAdmin;
    render();
  }
}

/* ================= FIREBASE ================= */
async function salvar(){
  await REF.set({nomesTimes,logosTimes,jogos},{merge:true});
}

/* ================= L√ìGICA ================= */
function atualizar(j,s,t,v){
  jogos[j].sets[s][t]=v===""?null:+v;
  salvar();
  renderClassificacao();
}

function calcular(){
  const stats={};
  TIMES.forEach(t=>stats[t]={j:0,sets:0,saldo:0,vit:0});

  jogos.forEach(j=>{
    let sa=0,sb=0,real=false;
    Object.values(j.sets).forEach(s=>{
      if(s.a!=null && s.b!=null){
        real=true;
        if(s.a>s.b){sa++;stats[j.a].sets++;stats[j.a].saldo++;stats[j.b].saldo--;}
        else{sb++;stats[j.b].sets++;stats[j.b].saldo++;stats[j.a].saldo--;}
      }
    });
    if(real){stats[j.a].j++;stats[j.b].j++;}
    if(sa>=2)stats[j.a].vit++;
    if(sb>=2)stats[j.b].vit++;
  });
  return stats;
}

/* ================= RENDER ================= */
function renderClassificacao(){
  const stats=calcular();
  const tb=document.getElementById("classificacao");
  tb.innerHTML="";
  Object.entries(stats)
    .sort(([,a],[,b])=>b.sets-a.sets||b.saldo-a.saldo)
    .forEach(([id,s],i)=>{
      tb.innerHTML+=`
      <tr class="${i<4?'classificado':''}">
        <td>${i+1}</td>
        <td>
          <div class="time-cell">
            ${logosTimes[id]?`<img src="${logosTimes[id]}">`:``}
            ${isAdmin
              ? `<div>
                   <input value="${nomesTimes[id]}" 
                     oninput="nomesTimes['${id}']=this.value;salvar();renderJogos()">
                   <input class="logo" placeholder="URL do logo"
                     value="${logosTimes[id]}"
                     oninput="logosTimes['${id}']=this.value;salvar();render()">
                 </div>`
              : nomesTimes[id]}
          </div>
        </td>
        <td>${s.j}</td><td>${s.sets}</td><td>${s.saldo}</td><td>${s.vit}</td>
      </tr>`;
    });
}

function renderJogos(){
  const div=document.getElementById("jogos");
  div.innerHTML="";
  jogos.forEach((j,i)=>{
    div.innerHTML+=`
    <div class="jogo">
      <h3>Jogo ${i+1}</h3>
      <div class="times">
        <div class="time">
          ${logosTimes[j.a]?`<img src="${logosTimes[j.a]}">`:``}
          ${nomesTimes[j.a]}
        </div>
        <div class="time">
          ${logosTimes[j.b]?`<img src="${logosTimes[j.b]}">`:``}
          ${nomesTimes[j.b]}
        </div>
      </div>
      ${Object.entries(j.sets).map(([k,s])=>`
        <div class="set">
          ${k.toUpperCase()}
          <div class="placar">
            <input ${!isAdmin?"disabled":""} value="${s.a??""}"
              onchange="atualizar(${i},'${k}','a',this.value)">
            x
            <input ${!isAdmin?"disabled":""} value="${s.b??""}"
              onchange="atualizar(${i},'${k}','b',this.value)">
          </div>
        </div>`).join("")}
    </div>`;
  });
}

function render(){
  renderClassificacao();
  renderJogos();
}

/* ================= START ================= */
async function iniciar(){
  const snap=await REF.get();
  if(snap.exists){
    const d=snap.data();
    nomesTimes=d.nomesTimes||nomesTimes;
    logosTimes=d.logosTimes||logosTimes;
    jogos=Array.isArray(d.jogos)?d.jogos:[];
  }
  if(jogos.length===0){criarJogos();salvar();}
  render();
}

iniciar();
</script>

</body>
</html>

