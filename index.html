<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>ğŸ Liga 4x4 AO VIVO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#004aad;color:white;margin:0;padding:10px}
h1,h2{text-align:center}
table{width:100%;background:white;color:black;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#111;color:white}
.classificado{background:#c40000;color:white}
.jogo{background:white;color:black;border-radius:8px;padding:10px;margin-bottom:10px}
.times{display:flex;justify-content:space-between;font-weight:bold}
.sets{display:flex;justify-content:space-around}
input{width:45px;text-align:center}
.admin input{background:#e8f5e8;border:2px solid #4CAF50}
button{position:fixed;bottom:20px;right:20px;padding:15px;border-radius:40px}
</style>
</head>

<body>

<h1>ğŸ Liga 4x4 AO VIVO</h1>

<h2>ğŸ† ClassificaÃ§Ã£o</h2>
<table>
<thead>
<tr><th>Pos</th><th>Time</th><th>J</th><th>Sets+</th><th>Saldo</th><th>V</th></tr>
</thead>
<tbody id="classificacao"></tbody>
</table>

<h2>ğŸ“± 66 Jogos</h2>
<div id="jogos"></div>

<button onclick="toggleAdmin()">ğŸ”§ ADMIN</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyCovHcUFKP9dtwRxfnajhvGUgluCFp0HVQ",
  projectId:"liga4x4volei-71358"
});
const db = getFirestore(app);
const ref = doc(db,"liga4x4","dados");

let jogos=[], nomesTimes={}, isAdmin=false;

/* ADMIN */
window.toggleAdmin=()=>{
  if(prompt("Senha ADMIN:")==="liga4x4"){
    isAdmin=!isAdmin;
    document.body.classList.toggle("admin",isAdmin);
    renderTudo();
  }
};

/* GERA BASE SEGURA */
function gerarBase(){
  const ids=[...Array(12)].map((_,i)=>"time"+(i+1));
  ids.forEach((id,i)=>nomesTimes[id]=nomesTimes[id]||`Time ${i+1}`);
  jogos=[];
  for(let i=0;i<ids.length;i++){
    for(let j=i+1;j<ids.length;j++){
      jogos.push({a:ids[i],b:ids[j],sets:[[null,null],[null,null],[null,null]]});
    }
  }
}

/* RENDER */
function renderTudo(){
  renderClassificacao();
  renderJogos();
  ativarEventos();
}

function renderJogos(){
  const el=document.getElementById("jogos");
  el.innerHTML=jogos.map((j,i)=>`
    <div class="jogo">
      <div class="times">
        <span>${nomesTimes[j.a]}</span>
        <span>VS</span>
        <span>${nomesTimes[j.b]}</span>
      </div>
      <div class="sets">
        ${[0,1,2].map(s=>`
          <input ${!isAdmin?"disabled":""} type="number" data-i="${i}" data-s="${s}" data-t="0" value="${j.sets[s][0]??""}">
          <input ${!isAdmin?"disabled":""} type="number" data-i="${i}" data-s="${s}" data-t="1" value="${j.sets[s][1]??""}">
        `).join("")}
      </div>
    </div>
  `).join("");
}

function renderClassificacao(){
  const stats={};
  Object.keys(nomesTimes).forEach(id=>stats[id]={j:0,sv:0,ss:0,v:0,id});
  jogos.forEach(j=>{
    let sa=0,sb=0;
    j.sets.forEach(s=>{
      if(s[0]!=null&&s[1]!=null){
        if(s[0]>s[1]){sa++;stats[j.a].sv++;stats[j.a].ss++;stats[j.b].ss--;}
        if(s[1]>s[0]){sb++;stats[j.b].sv++;stats[j.b].ss++;stats[j.a].ss--;}
      }
    });
    if(sa||sb){stats[j.a].j++;stats[j.b].j++;}
    if(sa>=2)stats[j.a].v++;
    if(sb>=2)stats[j.b].v++;
  });

  classificacao.innerHTML=Object.values(stats)
    .sort((a,b)=>b.sv-a.sv||b.ss-a.ss||b.v-a.v)
    .map((t,i)=>`
      <tr class="${i<4?"classificado":""}">
        <td>${i+1}</td>
        <td><input ${!isAdmin?"disabled":""} data-id="${t.id}" value="${nomesTimes[t.id]}"></td>
        <td>${t.j}</td><td>${t.sv}</td><td>${t.ss}</td><td>${t.v}</td>
      </tr>
    `).join("");
}

/* EVENTOS */
function ativarEventos(){
  document.querySelectorAll("td input[data-id]").forEach(inp=>{
    inp.oninput=()=>{
      nomesTimes[inp.dataset.id]=inp.value;
      renderJogos();
      salvar();
    };
  });

  document.querySelectorAll("input[type=number]").forEach(inp=>{
    inp.onchange=()=>{
      jogos[inp.dataset.i].sets[inp.dataset.s][inp.dataset.t]=inp.value===""?null:+inp.value;
      renderClassificacao();
      salvar();
    };
  });
}

/* FIREBASE ROBUSTO */
async function salvar(){ if(isAdmin) await setDoc(ref,{jogos,nomesTimes}); }

onSnapshot(ref,s=>{
  if(!s.exists() || !Array.isArray(s.data().jogos)){
    gerarBase();
    salvar();
  }else{
    jogos=s.data().jogos;
    nomesTimes=s.data().nomesTimes||nomesTimes;
  }
  renderTudo();
});
</script>

</body>
</html>
  
